é¡¹ç›®æŽ§åˆ¶å°
#1.å‘å¸ƒä»“åº“å‰ä½¿ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹æ˜¯å¦æœ‰æ— è­¦å‘Šå’Œé”™è¯¯æç¤º
flutter packages pub publish --dry-run
#2.å‘å¸ƒä»“åº“
flutter packages pub publish

è§£å†³å‘å¸ƒå†²çªå¦‚ä¸‹ï¼š
åœ¨ Flutter é‡Œå‡†å¤‡å‘å¸ƒ package æ—¶ï¼Œå¦‚æžœé‡åˆ° ä¾èµ–åŒ…å†²çªï¼Œä¸€èˆ¬æ˜¯å› ä¸ºä½ çš„ pubspec.yaml é‡ŒæŒ‡å®šçš„ä¾èµ–ç‰ˆæœ¬å’Œåˆ«çš„ä¾èµ–ï¼ˆæˆ– Flutter SDK è‡ªå¸¦çš„ä¾èµ–ï¼‰è¦æ±‚çš„ç‰ˆæœ¬ä¸å…¼å®¹ã€‚
è§£å†³æ€è·¯åˆ†å‡ æ­¥èµ°ï¼š

ðŸ” å¸¸è§å†²çªåœºæ™¯
1.ç›´æŽ¥ä¾èµ–å†²çª
ä½ å†™çš„ pubspec.yaml é‡Œä¾èµ–äº†æŸä¸ªåŒ…çš„ç‰ˆæœ¬ï¼Œè€Œå¦å¤–ä¸€ä¸ªä¾èµ–ä¹Ÿè¦æ±‚ä¸åŒç‰ˆæœ¬ã€‚

2.Flutter SDK è‡ªå¸¦ä¾èµ–å†²çª
Flutter SDK è‡ªå¸¦äº†æŸäº›åŒ…ï¼ˆæ¯”å¦‚ collectionã€asyncï¼‰ï¼Œä½ æŒ‡å®šçš„ç‰ˆæœ¬å’Œ SDK é‡Œä¸ä¸€è‡´ã€‚

3.ä¼ é€’ä¾èµ–å†²çª
ä½ å¹¶æ²¡æœ‰ç›´æŽ¥ä¾èµ–æŸä¸ªåŒ…ï¼Œä½†å®ƒè¢«å…¶ä»–ä¾èµ–å¼•ç”¨äº†ã€‚


âœ… è§£å†³æ–¹æ¡ˆ
1. ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬èŒƒå›´
åœ¨ pubspec.yaml é‡Œé¿å…å†™æ­»ç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼š
    dependencies:
      http: ^1.1.0   # æŽ¨èç”¨ ^ è€Œä¸æ˜¯ =1.1.0
è¿™æ · Dart çš„ä¾èµ–è§£æžå™¨ï¼ˆpub getï¼‰æœ‰æ›´å¤§ç©ºé—´é€‰æ‹©å…¼å®¹çš„ç‰ˆæœ¬ã€‚

2. ä½¿ç”¨ dependency_overrides
å¦‚æžœå¿…é¡»è¦å¼ºåˆ¶æŸä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨ pubspec.yaml é‡ŒåŠ ï¼š
    dependency_overrides:
      http: ^1.1.0
âš ï¸ ä½†æ˜¯æ³¨æ„ï¼šå¦‚æžœä½ è¦ å‘å¸ƒ package åˆ° pub.devï¼Œä¸è¦ä¿ç•™ dependency_overridesã€‚è¿™æ˜¯ä¸´æ—¶è§£å†³æœ¬åœ°å†²çªçš„æ–¹æ³•ï¼Œä¸æ˜¯é•¿æœŸæ–¹æ¡ˆã€‚

3. æ£€æŸ¥ Flutter SDK çº¦æŸ
ç¡®è®¤ pubspec.yaml é¡¶éƒ¨çš„çŽ¯å¢ƒçº¦æŸæ­£ç¡®ï¼š
    environment:
      sdk: ">=3.0.0 <4.0.0"
      flutter: ">=3.10.0"
å¦‚æžœçŽ¯å¢ƒå¤ªæ—§ï¼ŒæŸäº›ä¾èµ–æ–°ç‰ˆæœ¬å¯èƒ½ä¸å…¼å®¹ã€‚

4. ç”¨ flutter pub deps æ‰¾å†²çªæº
æ‰§è¡Œï¼š
    flutter pub deps --style=compact
å¯ä»¥æŸ¥çœ‹ä¾èµ–æ ‘ï¼Œæ‰¾åˆ°åˆ°åº•æ˜¯å“ªä¸ªä¾èµ–æ‹‰è¿›äº†å†²çªç‰ˆæœ¬ã€‚

5. ç”¨ resolution_strategyï¼ˆFlutter 3.27+ æ”¯æŒï¼‰
åœ¨æ–°ç‰ˆæœ¬çš„ pubspec.yaml å¯ä»¥åŠ ï¼š
    resolution_strategy:
      force_latest:
        - collection
        - http
è®© Dart åœ¨å†²çªæ—¶å¼ºåˆ¶é€‰æœ€æ–°ç‰ˆï¼Œä»£æ›¿ dependency_overridesï¼Œè€Œä¸” å¯ä»¥å‘å¸ƒåˆ° pub.devã€‚


ðŸš€ æœ€ä½³å®žè·µï¼ˆå‘å¸ƒ package æ—¶ï¼‰
1.é¿å…å†™æ­»ä¾èµ–ç‰ˆæœ¬ â†’ ç”¨ ^ æˆ– >= â€¦ < â€¦ã€‚
2.ç¡®ä¿ CI è·‘è¿‡ flutter pub publish --dry-run â†’ å®ƒä¼šæç¤ºä¾èµ–é—®é¢˜ã€‚
3.å¦‚æžœä¾èµ–å‡çº§å¤ªå¿«ï¼Œå°½é‡å…¼å®¹æ›´å®½ç‰ˆæœ¬èŒƒå›´ï¼Œæ¯”å¦‚ï¼š
    dependencies:
      http: ">=0.13.0 <2.0.0"
è¿™æ ·ä½ åŒæ—¶æ”¯æŒè€é¡¹ç›®å’Œæ–°é¡¹ç›®ã€‚